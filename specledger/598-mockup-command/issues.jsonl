{"id":"SL-675f7d","title":"Mockup Command","description":"Add sl mockup \u003cspec-name\u003e and sl mockup update commands that detect frontend frameworks, scan codebases for UI components, build a design system index (specledger/design_system.md), and generate ASCII mockups from feature specs mapped to the project actual components. Extends sl init to auto-create the design system for frontend projects during onboarding.","status":"open","priority":1,"issue_type":"epic","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:07.093033+07:00","updated_at":"2026-02-27T10:00:07.093033+07:00","labels":["spec:598-mockup-command","component:cli","component:mockup"]}
{"id":"SL-acaa90","title":"Phase 1: Setup - Package and Command Skeleton","description":"Initialize the pkg/cli/mockup/ domain package with shared types and create the Cobra command skeleton in pkg/cli/commands/mockup.go. Register VarMockupCmd in cmd/sl/main.go.","status":"open","priority":1,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:13.016607+07:00","updated_at":"2026-02-27T10:05:18.795359+07:00","blocks":["SL-e6485b"],"labels":["spec:598-mockup-command","phase:setup"],"parentId":"SL-675f7d"}
{"id":"SL-e6485b","title":"Phase 2: Foundational - Detector, Scanner, Design System I/O","description":"Core infrastructure that all user stories depend on: frontend framework detector (tiered heuristics), component scanner (glob + regex per framework), and design system file I/O (YAML frontmatter + markdown parsing/writing).","status":"open","priority":1,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:18.356017+07:00","updated_at":"2026-02-27T10:05:20.703477+07:00","blocked_by":["SL-acaa90"],"blocks":["SL-1e3e83","SL-520c1b","SL-2b6615","SL-a00981","SL-b0f5d0"],"labels":["spec:598-mockup-command","phase:foundational"],"parentId":"SL-675f7d"}
{"id":"SL-1e3e83","title":"Phase 3: US1 - Generate Mockup from Spec Using Design System","description":"P1 MVP story. When user runs sl mockup \u003cspec-name\u003e with an existing design_system.md, the system parses spec user stories, generates ASCII mockup screens mapped to design system components, and writes mockup.md to the feature directory.","status":"open","priority":1,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:23.684618+07:00","updated_at":"2026-02-27T10:05:21.08771+07:00","blocked_by":["SL-e6485b"],"blocks":["SL-c71d1f"],"labels":["spec:598-mockup-command","phase:us1","story:US1"],"parentId":"SL-675f7d"}
{"id":"SL-520c1b","title":"Phase 4: US2 - Auto-Create Design System Index When Missing","description":"P2 story. When design_system.md is missing, sl mockup auto-scans the codebase for UI components and generates the design system index before proceeding. Indexes both project components and third-party library usage.","status":"open","priority":2,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:28.604813+07:00","updated_at":"2026-02-27T10:05:19.666025+07:00","blocked_by":["SL-e6485b"],"labels":["spec:598-mockup-command","phase:us2","story:US2"],"parentId":"SL-675f7d"}
{"id":"SL-2b6615","title":"Phase 5: US3 - Frontend Detection and Design System Init","description":"P2 story. sl mockup detects the frontend framework (React/Vue/Svelte/Angular), initializes design system if missing, handles ambiguous repos (monorepo), and supports --force flag bypass for uncommon frameworks.","status":"open","priority":2,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:34.207838+07:00","updated_at":"2026-02-27T10:05:20.086861+07:00","blocked_by":["SL-e6485b"],"labels":["spec:598-mockup-command","phase:us3","story:US3"],"parentId":"SL-675f7d"}
{"id":"SL-a00981","title":"Phase 6: US4 - Update Design System Index","description":"P2 story. sl mockup update rescans the codebase, preserves manual edits, adds new components, removes stale entries, and writes the updated design_system.md.","status":"open","priority":2,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:39.214755+07:00","updated_at":"2026-02-27T10:05:21.572352+07:00","blocked_by":["SL-e6485b"],"blocks":["SL-c71d1f"],"labels":["spec:598-mockup-command","phase:us4","story:US4"],"parentId":"SL-675f7d"}
{"id":"SL-b0f5d0","title":"Phase 7: US5 - Initialize Design System During Onboarding","description":"P3 story. Extend sl init/bootstrap flow to detect frontend projects and auto-create specledger/design_system.md during onboarding. Interactive prompt in TUI mode, auto-create in CI mode.","status":"open","priority":3,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:45.562713+07:00","updated_at":"2026-02-27T10:05:20.703477+07:00","blocked_by":["SL-e6485b"],"labels":["spec:598-mockup-command","phase:us5","story:US5"],"parentId":"SL-675f7d"}
{"id":"SL-c71d1f","title":"Phase 8: Polish - JSON Output, Edge Cases, Tests","description":"Cross-cutting concerns: --json flag output for both commands, comprehensive error messages, edge case handling (empty/malformed design system, no user scenarios, uncommon frameworks), and unit tests for all domain logic.","status":"open","priority":3,"issue_type":"feature","spec_context":"598-mockup-command","created_at":"2026-02-27T10:00:51.025969+07:00","updated_at":"2026-02-27T10:05:21.572353+07:00","blocked_by":["SL-1e3e83","SL-a00981"],"labels":["spec:598-mockup-command","phase:polish"],"parentId":"SL-675f7d"}
{"id":"SL-462fc9","title":"Create shared types in pkg/cli/mockup/types.go","description":"WHY: All domain logic files (detector, scanner, designsystem, generator) depend on shared type definitions. This must be created first as the foundation for the entire mockup package.\n\nDESIGN: Create pkg/cli/mockup/types.go with all types from data-model.md: FrameworkType enum (react, nextjs, vue, nuxt, svelte, sveltekit, angular, unknown), DetectionResult struct, Component struct, PropInfo struct, DesignSystem struct, Mockup struct, Screen struct, ComponentRef struct, ScanResult struct, ScanError struct. Follow existing patterns in pkg/models/ for struct tags (yaml + json). Include validation constants (MinConfidence=70, SchemaVersion=1).\n\nACCEPTANCE: All types from data-model.md are defined. Package compiles. Other files in pkg/cli/mockup/ can import and use the types.\n\nDEFINITION OF DONE:\n[ ] pkg/cli/mockup/types.go created with all entity types from data-model.md\n[ ] FrameworkType enum with all 8 framework constants defined\n[ ] All structs have yaml and json struct tags\n[ ] Package compiles with go build ./pkg/cli/mockup/...","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:01:09.616506+07:00","updated_at":"2026-02-27T10:05:31.524253+07:00","definition_of_done":{"items":[{"item":"pkg/cli/mockup/types.go created with all entity types","checked":false},{"item":"FrameworkType enum with all 8 framework constants","checked":false},{"item":"All structs have yaml and json struct tags","checked":false},{"item":"Package compiles with go build","checked":false}]},"blocks":["SL-001c77","SL-9c05bf","SL-dd3052"],"labels":["spec:598-mockup-command","phase:setup","component:mockup"],"design":"File: pkg/cli/mockup/types.go. Reference: specledger/598-mockup-command/data-model.md for all type definitions. Follow struct tag patterns from pkg/models/.","acceptance_criteria":"All types from data-model.md are defined and the package compiles successfully.","parentId":"SL-acaa90"}
{"id":"SL-da1182","title":"Create mockup command skeleton and register in main.go","description":"WHY: The Cobra command definitions are the entry point for sl mockup \u003cspec-name\u003e and sl mockup update. Without the command skeleton, no user-facing functionality can be wired.\n\nDESIGN: Create pkg/cli/commands/mockup.go following existing patterns from issue.go and revise.go. Define VarMockupCmd as parent command with Use: mockup, Short: Generate UI mockups from feature specifications. Define mockupUpdateCmd as subcommand. Add package-level flag vars: mockupForceFlag (bool), mockupJSONFlag (bool). Register subcommand in init(). Add rootCmd.AddCommand(commands.VarMockupCmd) in cmd/sl/main.go init(). RunE handlers should be stubs returning nil initially.\n\nACCEPTANCE: sl mockup --help shows correct usage text matching contracts/cli.md. sl mockup update --help shows correct usage text. Command is registered and accessible from sl binary.\n\nDEFINITION OF DONE:\n[ ] pkg/cli/commands/mockup.go created with VarMockupCmd and mockupUpdateCmd\n[ ] Flag variables defined: mockupForceFlag (-f), mockupJSONFlag (--json)\n[ ] VarMockupCmd registered in cmd/sl/main.go\n[ ] sl mockup --help outputs correct help text\n[ ] sl mockup update --help outputs correct help text","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:01:22.751379+07:00","updated_at":"2026-02-27T10:05:43.754426+07:00","definition_of_done":{"items":[{"item":"pkg/cli/commands/mockup.go created with VarMockupCmd","checked":false},{"item":"mockupUpdateCmd subcommand defined","checked":false},{"item":"Flag vars: mockupForceFlag, mockupJSONFlag","checked":false},{"item":"VarMockupCmd registered in cmd/sl/main.go","checked":false},{"item":"Help text matches contracts/cli.md","checked":false}]},"blocks":["SL-497332","SL-354a9b"],"labels":["spec:598-mockup-command","phase:setup","component:cli"],"design":"File: pkg/cli/commands/mockup.go (new), cmd/sl/main.go (modify). Reference: contracts/cli.md for help text. Follow patterns from pkg/cli/commands/issue.go for command structure.","acceptance_criteria":"sl mockup --help and sl mockup update --help show correct usage matching contracts/cli.md","parentId":"SL-acaa90"}
{"id":"SL-001c77","title":"Implement frontend framework detector","description":"WHY: Frontend detection is the first step in the mockup command flow. All user stories depend on knowing whether the project is a frontend project and which framework it uses (FR-001, FR-008).\n\nDESIGN: Create pkg/cli/mockup/detector.go with DetectFramework(projectPath string) (*DetectionResult, error). Implement tiered detection from research.md: Tier 1 checks config files (next.config.js/ts/mjs -\u003e nextjs 99%, angular.json -\u003e angular 98%, svelte.config.js -\u003e sveltekit 97%, nuxt.config.js/ts -\u003e nuxt 97%, vite.config.js + .vue -\u003e vue 95%). Tier 2 parses package.json dependencies/devDependencies for react/react-dom, vue, @angular/core, svelte. Tier 3 scans for file extensions .tsx/.jsx, .vue, .svelte, .component.ts. Set IsFrontend=true only if Confidence\u003e=70. Populate ComponentDirs by checking standard paths per framework (src/components, components, app/components). Skip node_modules, vendor, .git, dist, build directories.\n\nACCEPTANCE: DetectFramework correctly identifies React, Next.js, Vue, Nuxt, Svelte, SvelteKit, and Angular projects. Returns IsFrontend=false for Go/Python/etc projects. Confidence thresholds match research.md.\n\nDEFINITION OF DONE:\n[ ] pkg/cli/mockup/detector.go created with DetectFramework function\n[ ] Tier 1 config file detection for all 6+ frameworks\n[ ] Tier 2 package.json dependency parsing\n[ ] Tier 3 file extension scanning\n[ ] ComponentDirs populated for detected frameworks\n[ ] Returns FrameworkUnknown with IsFrontend=false for non-frontend projects","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:01:39.749813+07:00","updated_at":"2026-02-27T10:05:49.719223+07:00","definition_of_done":{"items":[{"item":"DetectFramework function implemented with 3-tier detection","checked":false},{"item":"All 6+ frameworks detected from config files","checked":false},{"item":"package.json fallback parsing works","checked":false},{"item":"File extension scan as last resort","checked":false},{"item":"IsFrontend=false for non-frontend projects","checked":false}]},"blocked_by":["SL-462fc9"],"blocks":["SL-497332","SL-87cce5","SL-078da6"],"labels":["spec:598-mockup-command","phase:foundational","component:mockup","requirement:FR-001","requirement:FR-008"],"design":"File: pkg/cli/mockup/detector.go. Reference: research.md Decision 1 for heuristics. Uses os.Stat for config files, encoding/json for package.json, filepath.Glob for extensions.","acceptance_criteria":"Correctly identifies React, Next.js, Vue, Nuxt, Svelte, SvelteKit, Angular. Returns false for non-frontend.","parentId":"SL-e6485b"}
{"id":"SL-9c05bf","title":"Implement component scanner with framework-specific handlers","description":"WHY: The component scanner discovers UI components in the codebase to populate the design system index. Required by US2 (auto-create), US4 (update), and US5 (init integration) (FR-005, FR-008, FR-012).\n\nDESIGN: Create pkg/cli/mockup/scanner.go with ScanComponents(projectPath string, framework FrameworkType) (*ScanResult, error). Implement framework-specific scanning from research.md Decision 2. React/Next.js: glob src/components/**/*.{tsx,jsx}, components/**/*.{tsx,jsx}, app/components/**/*.{tsx,jsx}; identify via export default function/const + JSX returns; extract props from interface/type declarations. Vue: glob **/*.vue; identify via \u003ctemplate\u003e tag; extract props from defineProps. Svelte: glob **/*.svelte; identify via \u003cscript\u003e tag; extract props from export let. Angular: glob **/*.component.ts; identify via @Component decorator; extract @Input() props. Skip node_modules, vendor, .git, dist, build, .next, __pycache__. Track ScanDuration and FilesScanned. Collect non-fatal errors in ScanError slice.\n\nACCEPTANCE: Scans React, Vue, Svelte, Angular projects and returns Component structs with Name, FilePath, Props. Skips excluded directories. Handles large codebases (1000+ files) within performance budget.\n\nDEFINITION OF DONE:\n[ ] pkg/cli/mockup/scanner.go created with ScanComponents function\n[ ] React/Next.js scanning with glob + regex identification\n[ ] Vue scanning with .vue file detection\n[ ] Svelte scanning with .svelte file detection\n[ ] Angular scanning with .component.ts detection\n[ ] Props extraction for each framework\n[ ] Excluded directories are skipped\n[ ] ScanResult populated with duration and file count","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:01:59.046667+07:00","updated_at":"2026-02-27T10:05:43.112312+07:00","definition_of_done":{"items":[{"item":"ScanComponents function with framework-specific handlers","checked":false},{"item":"React/Next.js glob + regex scanning","checked":false},{"item":"Vue, Svelte, Angular scanning","checked":false},{"item":"Props extraction per framework","checked":false},{"item":"Excluded directories skipped","checked":false}]},"blocked_by":["SL-462fc9"],"blocks":["SL-e55a8e","SL-632f43"],"labels":["spec:598-mockup-command","phase:foundational","component:mockup","requirement:FR-005","requirement:FR-008"],"design":"File: pkg/cli/mockup/scanner.go. Reference: research.md Decision 2 for scanning patterns. Uses filepath.Glob, os.ReadFile, regexp for content analysis.","acceptance_criteria":"Scans 4 framework types, returns Component structs, skips excluded dirs, handles 1000+ files.","parentId":"SL-e6485b"}
{"id":"SL-dd3052","title":"Implement design system file I/O with YAML frontmatter","description":"WHY: The design system index (specledger/design_system.md) is the central artifact read by the mockup generator and written by the scanner. All user stories depend on reading or writing this file (FR-002, FR-003, FR-010).\n\nDESIGN: Create pkg/cli/mockup/designsystem.go with: LoadDesignSystem(path string) (*DesignSystem, error) - parses YAML frontmatter (version, framework, last_scanned, component_dirs, external_libs) and markdown body (component sections with Name, Path, Props, Description). WriteDesignSystem(path string, ds *DesignSystem) error - renders YAML frontmatter + markdown sections (Project Components grouped by directory, External Library Components grouped by library). InitializeDesignSystem(projectPath string, detection *DetectionResult) error - orchestrates scan + write. Use --- delimiters for frontmatter. Respect \u003c!-- MANUAL --\u003e markers for preserved sections. Format from research.md Decision 3.\n\nACCEPTANCE: Can round-trip a design_system.md file (load then write produces equivalent output). Preserves manual sections across updates. Handles missing file, empty file, malformed YAML gracefully.\n\nDEFINITION OF DONE:\n[ ] pkg/cli/mockup/designsystem.go created\n[ ] LoadDesignSystem parses YAML frontmatter + markdown body\n[ ] WriteDesignSystem renders back to markdown with frontmatter\n[ ] InitializeDesignSystem orchestrates scan and write\n[ ] Manual section markers (MANUAL) preserved on round-trip\n[ ] Graceful handling of missing/empty/malformed files","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:02:12.442695+07:00","updated_at":"2026-02-27T10:05:49.883409+07:00","definition_of_done":{"items":[{"item":"LoadDesignSystem with YAML frontmatter parsing","checked":false},{"item":"WriteDesignSystem with markdown rendering","checked":false},{"item":"InitializeDesignSystem orchestration","checked":false},{"item":"Manual section preservation","checked":false},{"item":"Edge case handling (missing/empty/malformed)","checked":false}]},"blocked_by":["SL-462fc9"],"blocks":["SL-bdc5a2","SL-497332","SL-e55a8e","SL-354a9b","SL-1033e3","SL-078da6"],"labels":["spec:598-mockup-command","phase:foundational","component:mockup","requirement:FR-002","requirement:FR-003","requirement:FR-010"],"design":"File: pkg/cli/mockup/designsystem.go. Reference: research.md Decision 3 for format. Uses gopkg.in/yaml.v3 for frontmatter, strings/regexp for markdown parsing.","acceptance_criteria":"Round-trip load/write produces equivalent output. Manual sections preserved. Handles edge cases gracefully.","parentId":"SL-e6485b"}
{"id":"SL-0b1e92","title":"Implement spec parser to extract user stories and requirements","description":"WHY: The mockup generator needs structured data from spec.md to know what screens to generate. It must extract user stories (title, priority, acceptance scenarios) and functional requirements to map UI needs (FR-004).\n\nDESIGN: Add ParseSpec(specPath string) function to pkg/cli/mockup/generator.go (or a separate parser.go if complex). Read spec.md file. Use regex to extract: User Story sections (### User Story N - Title (Priority: PX)), acceptance scenarios (Given/When/Then blocks), functional requirements (FR-NNN lines). Return a struct with []UserStory{Title, Priority, AcceptanceScenarios} and []string{FunctionalRequirements}. Handle edge case: no user stories found -\u003e return specific error for FR-009.\n\nACCEPTANCE: Parses the spec.md format used in this project. Extracts all user stories with priorities. Returns error when no user stories found. Works with the example spec at specledger/598-mockup-command/spec.md.\n\nDEFINITION OF DONE:\n[ ] ParseSpec function created\n[ ] Extracts user story titles and priorities (P1, P2, P3)\n[ ] Extracts acceptance scenarios per story\n[ ] Returns structured data usable by mockup generator\n[ ] Returns descriptive error when no user stories found (FR-009)","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:02:26.307506+07:00","updated_at":"2026-02-27T10:05:32.243219+07:00","definition_of_done":{"items":[{"item":"ParseSpec function extracts user stories","checked":false},{"item":"Priority extraction (P1, P2, P3)","checked":false},{"item":"Acceptance scenario extraction","checked":false},{"item":"Error on no user stories (FR-009)","checked":false}]},"blocks":["SL-bdc5a2"],"labels":["spec:598-mockup-command","phase:us1","story:US1","component:mockup","requirement:FR-004","requirement:FR-009"],"design":"File: pkg/cli/mockup/generator.go or parser.go. Uses os.ReadFile, regexp for section extraction. UserStory struct with Title, Priority, Scenarios fields.","acceptance_criteria":"Parses spec.md format, extracts all user stories with priorities, returns error when empty.","parentId":"SL-1e3e83"}
{"id":"SL-bdc5a2","title":"Implement mockup generator with ASCII screens and component mapping","description":"WHY: This is the core value of US1 - generating visual mockups that map UI elements to existing design system components (FR-004, FR-007). This is what makes the mockup command useful.\n\nDESIGN: Create pkg/cli/mockup/generator.go with GenerateMockup(spec *ParsedSpec, ds *DesignSystem) (*Mockup, error). For each P1 user story (minimum), generate Screen structs with ASCII art. Map UI needs from acceptance scenarios to Component entries in the design system. Build ComponentRef mapping table (UI Element -\u003e Component Name -\u003e Source path/library). Generate markdown output matching the format in research.md Decision 4: header with spec reference and date, per-screen ASCII wireframes in code blocks, component mapping table, user flow steps. Output to specledger/\u003cspec-name\u003e/mockup.md via WriteMockup(path string, m *Mockup) error. At minimum cover P1 stories; optionally include P2/P3.\n\nACCEPTANCE: Given a parsed spec and design system, generates a Mockup with at least one Screen per P1 story. ASCII wireframes contain component annotations. Component mapping table references actual design system entries. Output mockup.md is valid markdown.\n\nDEFINITION OF DONE:\n[ ] GenerateMockup function produces Mockup struct from spec + design system\n[ ] ASCII wireframe generation for each screen\n[ ] Component mapping table linking UI elements to design system entries\n[ ] User flow steps derived from acceptance scenarios\n[ ] WriteMockup renders to markdown matching research.md Decision 4 format\n[ ] Covers all P1 user stories at minimum","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:02:42.408094+07:00","updated_at":"2026-02-27T10:05:33.85534+07:00","definition_of_done":{"items":[{"item":"GenerateMockup function implemented","checked":false},{"item":"ASCII wireframe generation per screen","checked":false},{"item":"Component mapping table built","checked":false},{"item":"WriteMockup renders to markdown","checked":false},{"item":"P1 stories covered at minimum","checked":false}]},"blocked_by":["SL-dd3052","SL-0b1e92"],"blocks":["SL-497332"],"labels":["spec:598-mockup-command","phase:us1","story:US1","component:mockup","requirement:FR-004","requirement:FR-007"],"design":"File: pkg/cli/mockup/generator.go. Reference: research.md Decision 4 for output format. Uses fmt.Sprintf for ASCII art, strings.Builder for markdown. Depends on types.go (Mockup, Screen, ComponentRef) and designsystem.go (DesignSystem).","acceptance_criteria":"Generates ASCII mockups mapped to design system components, covers P1 stories, valid markdown output.","parentId":"SL-1e3e83"}
{"id":"SL-497332","title":"Wire sl mockup command handler with full flow orchestration","description":"WHY: This connects all the pieces: the command handler validates input, calls detector, loads/creates design system, parses spec, generates mockup, and writes output. This makes US1 end-to-end functional (FR-004, FR-007).\n\nDESIGN: In pkg/cli/commands/mockup.go, implement runMockup(cmd *cobra.Command, args []string) error. Flow: 1) Validate spec-name arg exists, check specledger/\u003cspec-name\u003e/spec.md exists (exit 1 if not). 2) Call mockup.DetectFramework(\".\") - if !IsFrontend \u0026\u0026 !mockupForceFlag, exit 2 with error. 3) Check specledger/design_system.md - if exists, call mockup.LoadDesignSystem(); if missing, call mockup.InitializeDesignSystem(). 4) Call mockup.ParseSpec(specPath) - if no user stories, exit 3. 5) Call mockup.GenerateMockup(parsedSpec, designSystem). 6) Call mockup.WriteMockup(outputPath, mockup). Print progress with ui.Checkmark(). Use existing patterns from issue.go for spec context and output formatting.\n\nACCEPTANCE: Running sl mockup \u003cspec-name\u003e on a frontend project with existing design_system.md produces mockup.md in the feature directory. Error messages match contracts/cli.md. Exit codes are correct.\n\nDEFINITION OF DONE:\n[ ] runMockup handler implemented with full flow\n[ ] Spec validation (exit 1 on missing)\n[ ] Frontend detection with --force bypass (exit 2)\n[ ] Design system load or auto-create\n[ ] Spec parsing with no-stories check (exit 3)\n[ ] Mockup generation and file write (exit 4 on error)\n[ ] Progress output with ui.Checkmark()\n[ ] Error messages match contracts/cli.md","status":"open","priority":1,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:02:59.158296+07:00","updated_at":"2026-02-27T10:05:50.37529+07:00","definition_of_done":{"items":[{"item":"runMockup handler with full orchestration flow","checked":false},{"item":"Spec validation with exit code 1","checked":false},{"item":"Detection with --force bypass and exit code 2","checked":false},{"item":"Design system load/auto-create","checked":false},{"item":"Mockup generation and file write","checked":false},{"item":"Error messages match contracts/cli.md","checked":false}]},"blocked_by":["SL-da1182","SL-001c77","SL-dd3052","SL-bdc5a2"],"blocks":["SL-87cce5","SL-bf1ecc","SL-e17fc9"],"labels":["spec:598-mockup-command","phase:us1","story:US1","component:cli","requirement:FR-004","requirement:FR-007","requirement:FR-011"],"design":"File: pkg/cli/commands/mockup.go (modify RunE). Reference: contracts/cli.md for exit codes and messages. Uses pkg/cli/mockup/ domain functions, pkg/cli/ui/ for output.","acceptance_criteria":"End-to-end sl mockup \u003cspec-name\u003e works on frontend project with existing design_system.md. Correct exit codes and error messages.","parentId":"SL-1e3e83"}
{"id":"SL-e55a8e","title":"Add auto-generation flow when design_system.md is missing","description":"WHY: US2 requires that when design_system.md does not exist, the system automatically scans the codebase and generates it before proceeding with mockup generation (FR-002, FR-005).\n\nDESIGN: The auto-generation is already scaffolded in the command handler (T008 calls InitializeDesignSystem when file missing). This task ensures the full flow works: 1) In runMockup, when LoadDesignSystem returns file-not-found, print 'Design system not found. Generating...' 2) Call ScanComponents with detected framework. 3) Build DesignSystem struct from ScanResult. 4) Call WriteDesignSystem. 5) Print scan stats (component count, duration). 6) Continue with mockup generation using the newly created design system. Handle edge cases: scanner returns 0 components (warn but continue), scanner errors on individual files (log and continue).\n\nACCEPTANCE: Running sl mockup \u003cspec-name\u003e on a frontend project WITHOUT design_system.md auto-creates it with discovered components, then generates the mockup. Each component has name, path, and description. Output messages match contracts/cli.md success example.\n\nDEFINITION OF DONE:\n[ ] Auto-detection triggers when design_system.md missing\n[ ] ScanComponents called with detected framework\n[ ] DesignSystem built from ScanResult\n[ ] WriteDesignSystem creates specledger/design_system.md\n[ ] Progress messages show scan stats\n[ ] Zero-component scan warns but continues\n[ ] Individual scan errors logged non-fatally","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:03:13.755185+07:00","updated_at":"2026-02-27T10:05:42.957676+07:00","definition_of_done":{"items":[{"item":"Auto-create triggers on missing design_system.md","checked":false},{"item":"Scan results written to design system file","checked":false},{"item":"Progress messages with scan stats","checked":false},{"item":"Zero-component and individual error handling","checked":false}]},"blocked_by":["SL-9c05bf","SL-dd3052"],"labels":["spec:598-mockup-command","phase:us2","story:US2","component:mockup","requirement:FR-002","requirement:FR-005"],"design":"Files: pkg/cli/commands/mockup.go (flow), pkg/cli/mockup/designsystem.go (InitializeDesignSystem). Connects scanner.go output to designsystem.go writer.","acceptance_criteria":"Auto-creates design_system.md with discovered components when missing. Continues to mockup generation.","parentId":"SL-520c1b"}
{"id":"SL-632f43","title":"Add third-party library detection to component scanner","description":"WHY: US2 acceptance scenario 3 requires indexing both custom project components AND identifiable library components used in the project (e.g., Material UI, Ant Design) (FR-005).\n\nDESIGN: Extend ScanComponents in pkg/cli/mockup/scanner.go. After scanning project components, scan source files for import statements matching known libraries: @mui/material, antd, @chakra-ui/react, @headlessui/react, @radix-ui/react-*. Use regex: import\\s*\\{([^}]+)\\}\\s*from\\s*['\"](@mui/material|antd|@chakra-ui/react|...)['\"]. For each match, create Component with IsExternal=true, Library=matched_lib, Name=imported_component. Deduplicate across files. Add to ScanResult.ExternalLibs and ScanResult.Components. Only scan .tsx, .jsx, .ts, .js, .vue, .svelte files for imports.\n\nACCEPTANCE: Given a project that imports from @mui/material, the scanner returns external components with correct Library and Name. ExternalLibs lists all detected libraries.\n\nDEFINITION OF DONE:\n[ ] Import regex patterns for MUI, Ant Design, Chakra, Headless UI, Radix\n[ ] External components added to ScanResult with IsExternal=true\n[ ] ExternalLibs populated in ScanResult\n[ ] Deduplication of external components across files\n[ ] Only source files scanned for imports","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:03:27.626189+07:00","updated_at":"2026-02-27T10:05:43.112312+07:00","definition_of_done":{"items":[{"item":"Import patterns for 5 common UI libraries","checked":false},{"item":"External components with IsExternal=true","checked":false},{"item":"ExternalLibs list populated","checked":false},{"item":"Deduplication across files","checked":false}]},"blocked_by":["SL-9c05bf"],"labels":["spec:598-mockup-command","phase:us2","story:US2","component:mockup","requirement:FR-005"],"design":"File: pkg/cli/mockup/scanner.go (extend ScanComponents). Reference: research.md Decision 2 Third-Party Library Detection section.","acceptance_criteria":"Detects import statements from known UI libraries and adds external components to scan results.","parentId":"SL-520c1b"}
{"id":"SL-87cce5","title":"Integrate frontend detection into mockup command with --force bypass","description":"WHY: US3 requires the mockup command to detect the frontend framework, initialize design system if needed, and support --force for uncommon frameworks (FR-001, FR-011).\n\nDESIGN: In pkg/cli/commands/mockup.go runMockup handler: 1) Call mockup.DetectFramework(\".\"). 2) Print detection result: framework name, confidence percentage. 3) If !result.IsFrontend \u0026\u0026 !mockupForceFlag: print error from contracts/cli.md (exit code 2). 4) If !result.IsFrontend \u0026\u0026 mockupForceFlag: print warning, set framework=unknown, proceed. 5) Pass DetectionResult to InitializeDesignSystem so it knows which scanner patterns to use. The --force flag is already defined in T002 command skeleton. This task wires the detection logic into the command flow.\n\nACCEPTANCE: Running sl mockup on a React project prints 'Detected: React (confidence: 95%)'. Running on a Go project without --force prints error. Running on a Go project with --force proceeds with warning. Monorepo detection warns about ambiguity.\n\nDEFINITION OF DONE:\n[ ] Detection result printed with framework and confidence\n[ ] Non-frontend exit with helpful error message (exit 2)\n[ ] --force flag bypasses detection with warning\n[ ] DetectionResult passed to downstream functions\n[ ] Error messages match contracts/cli.md","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:03:40.906262+07:00","updated_at":"2026-02-27T10:05:43.591223+07:00","definition_of_done":{"items":[{"item":"Detection result printed to user","checked":false},{"item":"Non-frontend error with exit code 2","checked":false},{"item":"--force bypass with warning","checked":false},{"item":"DetectionResult flows to downstream","checked":false}]},"blocked_by":["SL-001c77","SL-497332"],"blocks":["SL-e776d8"],"labels":["spec:598-mockup-command","phase:us3","story:US3","component:cli","requirement:FR-001","requirement:FR-011"],"design":"File: pkg/cli/commands/mockup.go (extend runMockup). Uses mockup.DetectFramework, ui.Checkmark for output.","acceptance_criteria":"Detection output shown, --force bypass works, error messages match contracts.","parentId":"SL-2b6615"}
{"id":"SL-e776d8","title":"Handle ambiguous repos and monorepo detection","description":"WHY: US3 acceptance scenario 2 requires handling ambiguous repos like monorepos with both backend and frontend portions.\n\nDESIGN: In pkg/cli/mockup/detector.go, add ambiguity detection: if multiple frameworks detected or if project has both backend indicators (go.mod, requirements.txt, Cargo.toml) AND frontend indicators, set a new Ambiguous bool on DetectionResult. In the command handler, if Ambiguous is true and not --force, print a warning suggesting the user cd to the frontend directory or use --force. Check for monorepo patterns: packages/, apps/, workspaces in package.json. If monorepo detected, suggest specific subdirectory.\n\nACCEPTANCE: Monorepo with both Go backend and React frontend triggers ambiguity warning. User can proceed with --force. Warning suggests cd to frontend directory.\n\nDEFINITION OF DONE:\n[ ] Ambiguous field added to DetectionResult\n[ ] Backend indicator detection (go.mod, requirements.txt, etc.)\n[ ] Monorepo pattern detection (packages/, apps/)\n[ ] Warning message for ambiguous repos\n[ ] --force overrides ambiguity warning","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:03:52.320466+07:00","updated_at":"2026-02-27T10:05:43.591223+07:00","definition_of_done":{"items":[{"item":"Ambiguous detection in DetectFramework","checked":false},{"item":"Backend indicator checks","checked":false},{"item":"Monorepo pattern detection","checked":false},{"item":"Warning message with directory suggestion","checked":false}]},"blocked_by":["SL-87cce5"],"labels":["spec:598-mockup-command","phase:us3","story:US3","component:mockup"],"design":"File: pkg/cli/mockup/detector.go (extend DetectFramework), pkg/cli/commands/mockup.go (handle ambiguous). Adds Ambiguous bool to DetectionResult.","acceptance_criteria":"Ambiguous repos trigger helpful warning. --force overrides. Monorepo patterns detected.","parentId":"SL-2b6615"}
{"id":"SL-354a9b","title":"Implement sl mockup update subcommand handler","description":"WHY: US4 requires a separate sl mockup update command to refresh the design system index after components change (FR-012).\n\nDESIGN: In pkg/cli/commands/mockup.go, implement runMockupUpdate(cmd *cobra.Command, args []string) error. Flow: 1) Check specledger/design_system.md exists (exit 1 if not, with error from contracts/cli.md). 2) Load existing design system. 3) Detect framework from loaded design system metadata. 4) Rescan components. 5) Call MergeDesignSystem (next task). 6) Write updated file. Print stats: total components, added count, removed count, scan duration. Exit codes per contracts/cli.md.\n\nACCEPTANCE: Running sl mockup update with existing design_system.md rescans and updates the file. Shows stats matching contracts/cli.md example. Returns error when design_system.md missing.\n\nDEFINITION OF DONE:\n[ ] runMockupUpdate handler implemented\n[ ] Validates design_system.md exists (exit 1 if not)\n[ ] Loads existing design system\n[ ] Rescans using stored framework type\n[ ] Prints add/remove/total stats\n[ ] Exit codes match contracts/cli.md","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:04:03.948947+07:00","updated_at":"2026-02-27T10:05:50.536176+07:00","definition_of_done":{"items":[{"item":"runMockupUpdate handler implemented","checked":false},{"item":"Design system existence validation","checked":false},{"item":"Rescan with stored framework","checked":false},{"item":"Stats output (added/removed/total)","checked":false},{"item":"Error on missing design_system.md","checked":false}]},"blocked_by":["SL-da1182","SL-dd3052"],"blocks":["SL-1033e3","SL-bf1ecc","SL-e17fc9"],"labels":["spec:598-mockup-command","phase:us4","story:US4","component:cli","requirement:FR-012"],"design":"File: pkg/cli/commands/mockup.go (runMockupUpdate RunE). Reference: contracts/cli.md for sl mockup update spec.","acceptance_criteria":"sl mockup update rescans and updates design_system.md with correct stats output.","parentId":"SL-a00981"}
{"id":"SL-1033e3","title":"Add merge logic for design system updates with manual preservation","description":"WHY: US4 acceptance scenarios require preserving manual edits, adding new components, and removing stale entries on update (FR-010, FR-012).\n\nDESIGN: Add MergeDesignSystem(existing *DesignSystem, scanned *ScanResult) (*DesignSystem, MergeStats) to pkg/cli/mockup/designsystem.go. MergeStats tracks: Added, Removed, Unchanged int. Logic: 1) Copy ManualEntries from existing (always preserved). 2) For each scanned component: if matches existing by FilePath, keep existing (may have manual description edits). If new, add to Components. 3) For each existing component NOT in scanned results AND not in ManualEntries: mark as removed (exclude from output). 4) Update LastScanned timestamp. 5) Return merged DesignSystem + stats.\n\nACCEPTANCE: Manual entries preserved across updates. New components added. Removed components dropped. Stats accurately reflect changes. Manually edited descriptions on existing components preserved.\n\nDEFINITION OF DONE:\n[ ] MergeDesignSystem function implemented\n[ ] ManualEntries always preserved\n[ ] New components added from scan\n[ ] Stale components removed\n[ ] Manually edited descriptions on existing components kept\n[ ] MergeStats accurately tracks added/removed/unchanged","status":"open","priority":2,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:04:17.832948+07:00","updated_at":"2026-02-27T10:05:44.230938+07:00","definition_of_done":{"items":[{"item":"MergeDesignSystem function with diff logic","checked":false},{"item":"ManualEntries preservation","checked":false},{"item":"New component addition","checked":false},{"item":"Stale component removal","checked":false},{"item":"Accurate MergeStats","checked":false}]},"blocked_by":["SL-dd3052","SL-354a9b"],"labels":["spec:598-mockup-command","phase:us4","story:US4","component:mockup","requirement:FR-010","requirement:FR-012"],"design":"File: pkg/cli/mockup/designsystem.go (add MergeDesignSystem). Uses map-based comparison by FilePath for diffing.","acceptance_criteria":"Preserves manual entries, adds new, removes stale, accurate stats.","parentId":"SL-a00981"}
{"id":"SL-078da6","title":"Add frontend detection to bootstrap.go init flow","description":"WHY: US5 requires sl init to auto-create design_system.md for frontend projects during onboarding (FR-006).\n\nDESIGN: In pkg/cli/commands/bootstrap.go, modify setupSpecLedgerProject() (or equivalent init function). After existing initialization steps: 1) Call mockup.DetectFramework(projectPath). 2) If result.IsFrontend: in interactive mode, prompt user 'Initialize design system? [Y/n]' using existing TUI patterns from tui.NewModeDetector(). Default to yes. In non-interactive/CI mode, auto-create without prompt. 3) If yes, call mockup.InitializeDesignSystem(projectPath, result). 4) Print result with ui.Checkmark(). 5) If detection fails or not frontend, skip silently (no error, just no design system). Import pkg/cli/mockup in bootstrap.go.\n\nACCEPTANCE: sl init on a React project creates specledger/design_system.md. sl init on a Go project does NOT create it. Interactive mode shows prompt. CI mode auto-creates.\n\nDEFINITION OF DONE:\n[ ] Frontend detection added to setupSpecLedgerProject\n[ ] Interactive prompt for design system init\n[ ] Auto-create in CI/non-interactive mode\n[ ] Success message with ui.Checkmark()\n[ ] Non-frontend projects skip silently\n[ ] No init failure if detection errors","status":"open","priority":3,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:04:31.240735+07:00","updated_at":"2026-02-27T10:05:49.883409+07:00","definition_of_done":{"items":[{"item":"Frontend detection in setupSpecLedgerProject","checked":false},{"item":"Interactive prompt with Y/n default","checked":false},{"item":"Auto-create in CI mode","checked":false},{"item":"Non-frontend projects skip silently","checked":false},{"item":"Detection errors do not fail init","checked":false}]},"blocked_by":["SL-001c77","SL-dd3052"],"labels":["spec:598-mockup-command","phase:us5","story:US5","component:cli","requirement:FR-006"],"design":"File: pkg/cli/commands/bootstrap.go (modify). Reference: research.md Decision 5, contracts/cli.md Init Integration section. Import pkg/cli/mockup.","acceptance_criteria":"sl init creates design_system.md for frontend projects, skips for non-frontend. Interactive prompt in TUI mode.","parentId":"SL-b0f5d0"}
{"id":"SL-bf1ecc","title":"Add --json output to mockup and mockup update commands","description":"WHY: Both commands need --json flag support for machine-readable output, enabling CI/CD integration and tooling.\n\nDESIGN: In pkg/cli/commands/mockup.go: 1) In runMockup, if mockupJSONFlag, collect result data into a struct matching contracts/cli.md JSON example (status, framework, spec_name, mockup_path, design_system_created, components_scanned, screens_generated). Marshal with json.MarshalIndent and print instead of human-readable output. 2) In runMockupUpdate, if mockupJSONFlag, output JSON matching contracts/cli.md (status, components_total, components_added, components_removed, scan_duration_ms). Suppress all non-JSON output when --json is set (no checkmarks, no progress text).\n\nACCEPTANCE: sl mockup \u003cspec\u003e --json outputs valid JSON matching contracts/cli.md. sl mockup update --json outputs valid JSON. No non-JSON text mixed in.\n\nDEFINITION OF DONE:\n[ ] JSON output for sl mockup matching contracts/cli.md format\n[ ] JSON output for sl mockup update matching contracts/cli.md format\n[ ] Non-JSON output suppressed when --json set\n[ ] Valid JSON parseable by jq","status":"open","priority":3,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:04:42.828261+07:00","updated_at":"2026-02-27T10:05:50.21226+07:00","definition_of_done":{"items":[{"item":"JSON output for sl mockup command","checked":false},{"item":"JSON output for sl mockup update command","checked":false},{"item":"Non-JSON output suppressed","checked":false},{"item":"Output parseable by jq","checked":false}]},"blocked_by":["SL-497332","SL-354a9b"],"labels":["spec:598-mockup-command","phase:polish","component:cli"],"design":"File: pkg/cli/commands/mockup.go. Uses encoding/json MarshalIndent. Reference: contracts/cli.md JSON examples.","acceptance_criteria":"Both commands output valid JSON matching contracts when --json flag is set.","parentId":"SL-c71d1f"}
{"id":"SL-e17fc9","title":"Comprehensive error handling and edge cases","description":"WHY: The spec defines several edge cases that must be handled gracefully to prevent crashes and confuse users.\n\nDESIGN: In relevant files across pkg/cli/mockup/ and pkg/cli/commands/mockup.go: 1) Empty/malformed design_system.md: in LoadDesignSystem, if YAML parse fails or version missing, treat as missing + warn user, re-generate. 2) No user scenarios in spec: ParseSpec returns ErrNoUserScenarios, handler prints contracts/cli.md error (exit 3). 3) No spec-name argument: cobra.ExactArgs(1) on VarMockupCmd already handles this, but customize the error message to match contracts/cli.md. 4) Hundreds of components: group by directory in WriteDesignSystem output, all included. 5) Write permission errors: catch os.ErrPermission, print contracts/cli.md error (exit 4). 6) Spec directory missing: check before write, create if needed. All error messages must match contracts/cli.md Error Messages table.\n\nACCEPTANCE: Each edge case from spec.md Edge Cases section is handled. Error messages match contracts/cli.md. No panics on bad input.\n\nDEFINITION OF DONE:\n[ ] Empty/malformed design system handled (re-generate with warning)\n[ ] No user scenarios error (exit 3)\n[ ] Missing spec-name argument error\n[ ] Large component sets grouped by directory\n[ ] Write permission error (exit 4)\n[ ] All error messages match contracts/cli.md","status":"open","priority":3,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:04:56.809165+07:00","updated_at":"2026-02-27T10:05:50.536176+07:00","definition_of_done":{"items":[{"item":"Malformed design system recovery","checked":false},{"item":"No user scenarios error handling","checked":false},{"item":"Permission error handling","checked":false},{"item":"Error messages match contracts","checked":false}]},"blocked_by":["SL-497332","SL-354a9b"],"labels":["spec:598-mockup-command","phase:polish","component:mockup","component:cli"],"design":"Files: pkg/cli/mockup/designsystem.go, generator.go, pkg/cli/commands/mockup.go. Reference: spec.md Edge Cases, contracts/cli.md Error Messages.","acceptance_criteria":"All edge cases handled gracefully with correct error messages and exit codes.","parentId":"SL-c71d1f"}
{"id":"SL-d47cb2","title":"Unit tests for detector, scanner, designsystem, and generator","description":"WHY: Unit tests validate the core domain logic in isolation, ensuring detection accuracy, scanner correctness, design system I/O integrity, and mockup generation quality.\n\nDESIGN: Create test files in pkg/cli/mockup/: 1) detector_test.go: table-driven tests for DetectFramework - test fixtures with next.config.js, angular.json, package.json with react dep, .tsx files, non-frontend Go project. Verify framework, confidence, IsFrontend for each. 2) scanner_test.go: test fixtures with sample component files per framework. Verify component names, props, file paths extracted correctly. Test excluded directory skipping. 3) designsystem_test.go: test LoadDesignSystem with sample markdown, WriteDesignSystem round-trip, MergeDesignSystem with add/remove/preserve scenarios. Test manual marker preservation. 4) generator_test.go: test ParseSpec with sample spec.md. Test GenerateMockup produces screens with component refs. Use t.TempDir() for filesystem fixtures. Follow table-driven test patterns from existing tests.\n\nACCEPTANCE: All tests pass. Tests cover happy path + edge cases for each module. go test ./pkg/cli/mockup/... reports no failures.\n\nDEFINITION OF DONE:\n[ ] detector_test.go with framework detection table tests\n[ ] scanner_test.go with per-framework scan tests\n[ ] designsystem_test.go with load/write/merge tests\n[ ] generator_test.go with parse/generate tests\n[ ] All tests pass with go test ./pkg/cli/mockup/...","status":"open","priority":3,"issue_type":"task","spec_context":"598-mockup-command","created_at":"2026-02-27T10:05:10.923437+07:00","updated_at":"2026-02-27T10:05:10.923437+07:00","definition_of_done":{"items":[{"item":"detector_test.go with table-driven framework tests","checked":false},{"item":"scanner_test.go with per-framework tests","checked":false},{"item":"designsystem_test.go with round-trip tests","checked":false},{"item":"generator_test.go with spec parsing tests","checked":false},{"item":"All tests pass","checked":false}]},"labels":["spec:598-mockup-command","phase:polish","component:mockup","test:unit"],"design":"Files: pkg/cli/mockup/*_test.go. Use testing.T, t.TempDir() for fixtures, table-driven tests. Follow patterns in existing test files.","acceptance_criteria":"All test files created and passing. Covers happy path and edge cases for all domain modules.","parentId":"SL-c71d1f"}
