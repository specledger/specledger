# Implementation Plan: CLI Authentication

**Branch**: `008-cli-auth` | **Date**: 2026-02-10 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specledger/008-cli-auth/spec.md`

## Summary

Add browser-based OAuth authentication to the SpecLedger CLI, enabling users to securely authenticate via `sl auth login` for accessing protected features like private specifications and remote synchronization. The implementation includes a local callback server, secure credential storage, token refresh mechanism, and CI/CD-friendly headless authentication options.

## Technical Context

**Language/Version**: Go 1.24.2
**Primary Dependencies**: Cobra (CLI framework), net/http (callback server), encoding/json (credential storage)
**Storage**: File-based (`~/.specledger/credentials.json`) with 0600 permissions
**Testing**: Go testing framework with integration tests in `tests/integration/`
**Target Platform**: Cross-platform (macOS, Linux, Windows)
**Project Type**: Single CLI application
**Performance Goals**: Authentication callback within 100ms, token refresh within 1 second
**Constraints**: 5-minute authentication timeout, single callback port (2026)
**Scale/Scope**: Single-user CLI tool, local credential storage

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

Verify compliance with principles from `.specledger/memory/constitution.md`:

- [x] **Specification-First**: Spec.md complete with prioritized user stories (5 user stories with P1-P3 priorities)
- [x] **Test-First**: Test strategy defined (integration tests for auth flow, unit tests for credential management)
- [x] **Code Quality**: Go standard formatting (gofmt), existing linting in project
- [x] **UX Consistency**: User flows documented in spec.md acceptance scenarios (login, logout, status, refresh)
- [x] **Performance**: Metrics defined - callback <100ms, refresh <1s, timeout 5min
- [x] **Observability**: CLI output provides clear status messages and error information
- [x] **Issue Tracking**: Feature documented as 008-cli-auth branch

**Complexity Violations**: None identified

## Project Structure

### Documentation (this feature)

```text
specledger/008-cli-auth/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output (API contracts)
├── checklists/          # Quality checklists
│   └── requirements.md  # Specification quality checklist
└── tasks.md             # Phase 2 output (generated by /specledger.tasks)
```

### Source Code (repository root)

```text
cmd/
└── sl/
    └── main.go           # CLI entry point (modified to add auth command)

pkg/
└── cli/
    ├── auth/             # NEW: Authentication package
    │   ├── browser.go    # Cross-platform browser opening
    │   ├── client.go     # API client for token refresh
    │   ├── credentials.go # Credential storage management
    │   └── server.go     # Local OAuth callback server
    └── commands/
        └── auth.go       # NEW: Auth command definitions

tests/
└── integration/
    └── auth_test.go      # Integration tests for auth flow (to be added)
```

**Structure Decision**: Single CLI project structure following existing patterns. Auth functionality added as new `pkg/cli/auth/` package with corresponding command file in `pkg/cli/commands/auth.go`.

## Complexity Tracking

No violations requiring justification.
